import{o as T,a as E}from"./users-B1oCCdPH.js";import{l as M}from"./inventory-CC2awVC6.js";import{loadProducts as B}from"./products-Dhk6BMgA.js";T(E,u=>{u?(document.body.style.visibility="visible",S()):window.location.href="/login.html"});async function S(){const u=await B(),m=await M();window.inventory=m;const g={};u.forEach(e=>g[e.name]=e);let b=0,p=0,r=0,c=0;const x=new Date,f={factory:[],shipping:[],port:[],warehouse:[],installed:[],unknown:[]},y=[],k=["enova warehouse","back warehouse"];m.forEach(e=>{var a;const t=g[e.model]||g[e.product],i=(t==null?void 0:t.isPublicAsset)||!1,l=parseFloat(t==null?void 0:t.price)||0;let n=null;const o=((a=e.location)==null?void 0:a.toLowerCase())||"";if(o.includes("public")||o.includes("arrived")||o.includes("installed")?n="installed":k.includes(o)?n="warehouse":o.includes("port")?n="port":o.includes("shipping")?n="shipping":o.includes("factory")?n="factory":n="unknown",n&&n!=="installed"&&f[n]&&f[n].push(e),i||o.includes("public")){b++,r+=l;const d=parseFloat(t==null?void 0:t.depreciationRate)/100||.15,v=new Date(e.installedDate||e.lastAction||e.created),s=(x-v)/(365.25*24*3600*1e3),L=l*Math.pow(1-d,s);y.push({chargerId:e.chargerId,model:e.model,installDate:v.toLocaleDateString(),originalValue:l,depreciationRate:d,years:s.toFixed(2),currentValue:L.toFixed(0),location:e.location})}else t&&(p++,c+=l)});const h=["bg-red-400 dark:bg-red-700","bg-orange-400 dark:bg-orange-700","bg-yellow-400 dark:bg-yellow-700","bg-green-400 dark:bg-green-700","bg-blue-400 dark:bg-blue-700","bg-indigo-400 dark:bg-indigo-700","bg-purple-400 dark:bg-purple-700"],C=[{label:"Public Chargers",value:b,value2:`$${r.toLocaleString()}`},{label:"Inventory Chargers",value:p,value2:`$${c.toLocaleString()}`},{label:"Total Chargers",value:b+p,value2:""}].map((e,t)=>({...e,color:h[t%h.length]}));function $(){const e=document.getElementById("kpi-cards");e&&(e.innerHTML=C.map(t=>`
        <div class="${t.color} rounded-xl p-6 text-center shadow text-white">
            <div class="text-2xl font-bold">${t.value}</div>
            <div class="text-lg">${t.label}</div>
            ${t.value2?`<div class="text-lg font-semibold mt-1">${t.value2}</div>`:""}
        </div>`).join(""))}function I(){var t,i;const e=(t=document.getElementById("assetDonut"))==null?void 0:t.parentElement;if(e)if(r===0&&c===0)e.innerHTML='<div class="text-gray-400 text-center pt-24">No asset data to display</div>';else{const l=(i=document.getElementById("assetDonut"))==null?void 0:i.getContext("2d");l&&new Chart(l,{type:"doughnut",data:{labels:["Public Assets","Inventory"],datasets:[{data:[r,c],backgroundColor:["#8b5cf6","#38bdf8"],borderWidth:2,borderColor:"#fff"}]},options:{plugins:{legend:{position:"bottom"}},maintainAspectRatio:!1}})}}function D(e){const t=document.getElementById("milestone-progress");if(!t)return;const i=[{key:"factory",label:"Factory"},{key:"shipping",label:"Shipping"},{key:"port",label:"Port"},{key:"warehouse",label:"Warehouse"}],l=i.reduce((n,o)=>{var a;return n+(((a=e[o.key])==null?void 0:a.length)||0)},0);if(l===0){t.innerHTML='<div class="text-gray-400 text-center">No assets in transit.</div>';return}t.innerHTML=`
      <div class="flex items-center justify-between mb-2">
        ${i.map(n=>{var o;return`<div class="flex flex-col items-center flex-1"><div class="text-lg font-semibold">${((o=e[n.key])==null?void 0:o.length)||0}</div><div class="text-xs text-gray-600">${n.label}</div></div>`}).join("")}
      </div>
      <div class="flex w-full h-4 rounded bg-gray-200 overflow-hidden shadow">
        ${i.map((n,o)=>{var s;const a=((s=e[n.key])==null?void 0:s.length)||0,d=l?a/l*100:0;return`<div class="${["bg-purple-400","bg-blue-400","bg-yellow-400","bg-green-400"][o%4]}" style="width:${d}%;"></div>`}).join("")}
      </div>`}function P(e){const t=document.getElementById("depreciation-summary");if(!t)return;const i=e.reduce((o,a)=>o+Number(a.originalValue),0),l=e.reduce((o,a)=>o+Number(a.currentValue),0),n=i-l;t.innerHTML=`Total Depreciation This Year: <span class="text-purple-600">$${n.toLocaleString()}</span>`}const w=document.getElementById("moveToPortBtn");w&&(w.onclick=async()=>{const e=(window.inventory||[]).map(t=>t.chargerId);console.log("Move to Port clicked for units:",e)}),$(),I(),D(f),P(y)}
